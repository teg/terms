\documentclass[11pt,a4paper]{article}

% A more pleasant font
\usepackage[T1]{fontenc} % use postscript type 1 fonts
\usepackage{textcomp} % use symbols in TS1 encoding
%\usepackage[garamond]{mathdesign} % use a nice font

% Improves the text layout
\usepackage{microtype}

% To typeset derivations
\usepackage[lutzsyntax,noxy]{virginialake}

% Allow inclusion of graphics
\usepackage[pdftex]{graphicx}

% To get semantic brackets
\usepackage{stmaryrd}

% To use definitions, lemmas and theorems.
\usepackage{amsthm}
\theoremstyle{definition}
\newtheorem{definition}{Definition}
\theoremstyle{plain}
\newtheorem{lemma}[definition]{Lemma}
\newtheorem{theorem}[definition]{Theorem}
\theoremstyle{remark}
\newtheorem{remark}[definition]{Remark}

% Might not be needed, didn't check.
\usepackage{amsfonts}

% To get cases in equations
\usepackage{amsmath}

\title{An Atomic Term Calculus}
\author{Tom Gundersen, Willem Heijltjes and Michel Parigot}

\begin{document}

\maketitle

\abstract{
A proof system for minimal logic with explicit, atomic structural rules is introduced, together with a normalisation procedure. Furthermore, a term calculus is defined, together with an atomic rewrite system corresponding to the proof normalisation. A denotation of the term calculus is given in terms of the lambda calculus, and it is shown that the new term calculus simulates $\beta$-reduction and preserve strong normalisation.
}

\section{Terms}

\newcommand{\FV}{{\mathop{\mathsf{FV}}}}
\newcommand{\Var}{{\mathop{\mathsf{Var}}}}
\newcommand{\tertuple}[2]{{\langle{#1},\dots,{#2}{\rangle}}}
\newcommand{\terauxshare}[3]
{
  {
    {#1}[{#2}\leftarrow{#3}]
  }
}
\newcommand{\terauxdist}[3]
{
  {
    {#1}[{#2}\twoheadleftarrow{#3}]
  }
}
\newcommand{\tershare}[4]
{
  {
    \terauxshare
    {#1}
    {{#2},\dots,{#3}}
    {#4}
  }
}
\newcommand{\ternullshare}[2]{{\terauxshare{#1}{}{#2}}}
\newcommand{\terbishare}[4]
{
  {
    \terauxshare
    {#1}
    {{#2},{#3}}
    {#4}
  }
}
\newcommand{\terdist}[5]
{
  {
    \terauxdist
    {#1}
    {{#2},\dots,{#3}}
    {\lambda{#4}.{#5}}
  }
}
\newcommand{\terunadist}[4]
{
  {
    \terauxdist
    {#1}
    {#2}
    {\lambda{#3}.{#4}}
  }
}
\newcommand{\tersub}[3]{{{#1}\{{#2}\leftarrow{#3}\}}}
\newcommand{\tersubn}[5]{{{#1}\{{#2}\leftarrow{#3},\dots,{#4}\leftarrow{#5}\}}}

Where applicable we assume that all variables are fresh, so that we do not bother with $\alpha$-conversion.

\subsection{Pre Terms}

\newcommand{\mul}{{\mathop{\mathsf{mul}}}}

\begin{itemize}
	\item $x$;
	\item $\lambda x.u$;
	\item $(u)t$;
	\item $\tershare{u}{x_1}{x_n}{t}$;
	\item $\terdist{u}{x_1}{x_n}{y}{t}$, where $\mul(t)=n$; and
	\item $\tertuple{t_1}{t_n}$.
\end{itemize}

The \emph{multiplicity}, $\mul(t)$, of a term $t$ is defined as follows

\begin{itemize}
	\item $\mul(x)=\mul(\lambda x.u)=\mul((u)t)=1$
	\item $\mul(\tershare{u}{x_1}{x_n}{t})=\mul(\terdist{u}{x_1}{x_n}{y}{t})=\mul(u)$; and
	\item $\mul(\tertuple{t_1}{t_n})=n$.
\end{itemize}

\newcommand{\terpr}[2]{{\pi_{#1}({#2})}}

The \emph{$i^{th}$ projection}, $\terpr{i}{\tertuple{t_1}{t_n}}$ of a tuple is defined to be $t_i$, as usual.

\subsection{Lambda Terms}

The set of $\lambda$-terms, $\Lambda$ is a subset of pre-terms, as expected:

\begin{itemize}
	\item $x$;
	\item $\lambda x.u$; and
	\item $(u)t$.
\end{itemize}

\subsection{Explicit Sharing Terms}

The set of explicit sharing terms, $\Lambda_S$ is a subset of pre-terms restricted in the following way:

\begin{itemize}
	\item $x$;
	\item $\lambda x.u$, where $x\in\FV(u)$ and $\mul(u)=1$;
	\item $(u)t$, where $\Var(u)\cap\Var(t)=\emptyset$ and $\mul(u)=\mul(t)=1$;
	\item $\tershare{u}{x_1}{x_n}{t}$, where $\{x_1,\dots,x_n\}\subset\FV(u)$, $\Var(u)\cap\Var(t)=\emptyset$ and $\mul(t)=1$;
	\item $\terdist{u}{x_1}{x_n}{y}{t}$, where $\{x_1,\dots,x_n\}\subset\FV(u)$, $y\in\FV(t)$, $\Var(u)\cap\Var(t)=\emptyset$ and $\mul(t)=n$; and
	\item $\tertuple{t_1}{t_n}$, where for every $i,j$ we have $\Var(t_i)\cap\Var(t_j)=\emptyset$ and $\mul(t_i)=1$,
\end{itemize}
Furthermore, we only consider terms of multiplicity one.

\subsection{Explicit Sharing Normal Form}

The set of terms of \emph{explicit sharing normal form} $\Lambda_{NS}\subset\Lambda_S$ is defined as:

\begin{itemize}
	\item $x$;
	\item $\lambda x.\tershare{u}{x_1}{x_n}{x}$;
	\item $(u)t$; and 
	\item $\tershare{\tershare{u}{y_{1,1}}{y_{1,k_1}}{y_1}\cdots}{y_{p,1}}{y_{p,k_p}}{y_p}$,
\end{itemize}
where $u$ and $t$ are not on the form $\tershare{v}{z_1}{z_m}{w}$ and $y_1$, $\dots$, $y_p$ are not bound.

In other words, a term is on explicit sharing normal form if only variables are shared, and sharing only takes place at the root of the term or immediately under the abstraction that binds the variable.

\subsection{Denotation}

\newcommand{\terden}[1]{{\llbracket{#1}\rrbracket}}

The function $\terden{-}:\Lambda\rightarrow\Lambda_S$ maps lambda terms to explicit sharing terms

\begin{itemize}
	\item $\terden{x}=x$;
	\item $\terden{\lambda x.u}=
	  \begin{cases}
	      \lambda x.\terden{u}, & \mbox{if }x\in\FV(u) \\
	      \lambda x.\ternullshare{\terden{u}}{x}, & \mbox{otherwise}
	  \end{cases}$; and
	\item $\terden{(u)t}=\terbishare{\terbishare{(\terden{u'})\terden{t''}}{x'_1}{x''_1}{x_1}\cdots}{x'_n}{x''_n}{x_n}$,
\end{itemize}
where $x_1$, $\dots$, $x_n$ are the variables in common between $u$ and $t$, and $u'$ (resp., $t''$) is obtained from $u$ (resp., $t$) by substituting each of the $x_i$s by $x_i'$ (resp., $x_i''$).

\newcommand{\tercoden}[1]{{\lfloor{#1}\rfloor}}

The function $\tercoden{-}:\Lambda_S\rightarrow\Lambda$ maps explicit sharing terms to lambda terms

\begin{itemize}
	\item $\tercoden{x}=x$;
	\item $\tercoden{\lambda x.u}=\lambda x.\tercoden{u}$;
	\item $\tercoden{(u)t}=(\tercoden{u})\tercoden{v}$;
	\item $\tercoden{\tershare{u}{x_1}{x_n}{t}}=\tersubn{\tercoden{u}}{x_1}{\tercoden{t}}{x_n}{\tercoden{t}}$;
	\item $\tercoden{\terdist{u}{x_1}{x_n}{y}{t}}=\tersubn{\tercoden{u}}{x_1}{\lambda y.\terpr{1}{\tercoden{t}}}{x_n}{\lambda y.\terpr{n}{\tercoden{t}}}$; and
	\item $\tercoden{\tertuple{t_1}{t_n}}=\tertuple{\tercoden{t_1}}{\tercoden{t_n}}$.
\end{itemize}

\begin{lemma}
 When $\tercoden{-}$ is restricted to $\Lambda_{NS}$, then $\tercoden{\terden{-}}=\terden{\tercoden{-}}=\mathsf{id}$.
\end{lemma}


\section{Reductions}

\subsection{$\beta$-reduction}

We define $\beta$-reductions on pre-terms as follows:

\[(\lambda x.u)t \rightsquigarrow_\beta \tersub{u}{x}{t}\;.\]

One $\beta$ reduction in the lambda calculus corresponds to one $\beta$ reduction in the explicit sharing calculus, whereas one $\beta$ reduction in the explicit sharing calculus corresponds to one or more $\beta$ reductions in the lambda calculus:

\begin{lemma}
For any lambda terms $u$ and $v$, if $u\rightsquigarrow_\beta v$ then $\tercoden{u}\rightsquigarrow_\beta\tercoden{v}$.
\end{lemma}

\begin{lemma}
For any explicit sharing terms $u$ and $v$, if $u\rightsquigarrow_\beta v$ then $\terden{u}\rightsquigarrow^\star_\beta\terden{v}$
\end{lemma}

This is as we expect, as we hope to get optimality (though will not claim that in this paper).

\subsection{Sharing Reductions}

The following reductions are designed to transform any explicit sharing term into explicit sharing normal form.

\subsubsection{Quotient of terms}

We consider terms equal modulo the following equation:

TBD

\subsubsection{Sharing to the Root}

\begin{itemize}
 \item $\lambda x.\tershare{u}{x_1}{x_n}{t}\rightsquigarrow\tershare{\lambda x.u}{x_1}{x_n}{t}$, if $x\not\in\FV(t)$;
 \item \begin{itemize}
        \item $(\tershare{u}{x_1}{x_n}{v})t\rightsquigarrow\tershare{(u)t}{x_1}{x_n}{v}$;
        \item $(u)\tershare{t}{x_1}{x_n}{v}\rightsquigarrow\tershare{(u)t}{x_1}{x_n}{v}$;
       \end{itemize}
 \item $\tershare{u}{x_1}{x_n}{\tershare{v}{y_1}{y_m}{t}}\rightsquigarrow\tershare{\tershare{u}{x_1}{x_n}{v}}{y_1}{y_m}{t}$; and
 \item $\terdist{u}{x_1}{x_n}{z}{\tershare{v}{y_1}{y_m}{t}}\rightsquigarrow\tershare{\terdist{u}{x_1}{x_n}{z}{v}}{y_1}{y_m}{t}$, if $z\not\in\FV(t)$.
\end{itemize}

\subsubsection{Merge Sharing}

\begin{itemize}
 \item $\terauxshare{\tershare{u}{x_1}{x_n}{y_i}}{y_1,\dots,y_i,\dots,y_m}{t}\rightsquigarrow
	\terauxshare{u}{y_1,\dots,y_{i-1},x_1,\dots,x_n,y_{i+1},\dots,y_m}{t}$.
\end{itemize}

We might also want to add a rule to merge sharing with distribution, but it is not necessary for this paper (but might be for optimality).

\subsubsection{Distribute}

\begin{itemize}
 \item $\tershare{u}{x_1}{x_n}{\lambda x.t} \rightsquigarrow \terdist{u}{x_1}{x_n}{x}{\tershare{\tertuple{y_1}{y_n}}{y_1}{y_n}{t}}$;
 \item $\tershare{u}{x_1}{x_n}{(v)t} \rightsquigarrow \tershare{\tershare{\tersubn{u}{x_1}{(y_1)z_1}{x_n}{(y_n)z_n}}{y_1}{y_n}{v}}{z_1}{z_n}{t}$; and
 \item $\terdist{u}{x_1}{x_n}{y}{\terauxshare{\tertuple{t_1}{t_n}}{y_{1,1},\dots,y_{1,k_1},\dots,y_{n,1},\dots,y_{n,k_n}}{y}}\rightsquigarrow \tersubn{u}{x_1}{\lambda y_1.\tershare{t_1}{y_{1,1}}{y_{1,k_1}}{y_1}}{x_n}{\lambda y_n.\tershare{t_n}{y_{n,1}}{y_{n,k_n}}{y_n}}$, where for every $i$ we have $\{y_{i,1},\dots,y_{i,k_i}\}\subset\FV(t_i)$.
\end{itemize}

\begin{lemma}
For any explicit sharing terms $u$ and $v$, if $u\rightsquigarrow v$, then $\terden{u}=\terden{v}$.
\end{lemma}

\begin{lemma}
The reduction $\rightsquigarrow$ is strongly normalizing.
\end{lemma}

\begin{theorem}
PSN.
\end{theorem}

\section{Types}

We denote by upper-case latin letters $A$, $B$, $C$, $X$, $Y$, and $Z$ object-formulae built from atoms and implications. We denote by upper-case greek letters $\Gamma$ and $\Delta$ meta-formulae built from object-formulae and conjunctions.

\subsection{Inference Rules}

\[
\vlinf{}{}{A\rightarrow\vlsbr(A.\Gamma)}{\Gamma}
\]

\[
\vlinf{}{}{B}{\vls(A.[A\rightarrow B])}
\]

\[
\vlinf{}{}{\vls(A.\dots.A)}{A}
\]

\[
\vlinf{}{}{\vls([A\rightarrow B_1].\dots.[A\rightarrow B_n])}{A\rightarrow\vlsbr(B_1.\dots.B_n)}
\]

\subsection{Typing Derivations}

\begin{itemize}
 \item $x$:
\[
  A
\]
 \item $\lambda x.t$:
\[
  \vlinf{}{}{A^x\vlim \vlder{}{t}{B}{\vls(A^x.\Gamma)}}{\Gamma}
\]
 \item $(u)v$:
\[
  \vlinf{}{}{B}{\vls(\vlder{}{u}{A\vlim B}{\Gamma}\;\;.\;\;\vlder{}{v}{A}{\Delta})}
\]
 \item $\tershare{u}{x_1}{x_n}{v}$:
\[
  \vlder{}{u}{B}{\vlsbr(\vlderivation{\vlin{}{}{\vls(A^{x_1}.\cdots.A^{x_n})}{\vlde{}{v}{A}{\vlhy{\Gamma}}}}\;\;\;.\;\;\;\Delta)}
\]
 \item $\terdist{u}{x_1}{x_n}{y}{t}$:
\[
  \vlder{}{u}{B}{\vlsbr(\vlinf{}{}{\vls((A\vlim B_1)^{x_1}.\cdots.(A\vlim B_n)^{x_n})}{\vlinf{}{}{A^y\vlim\vlder{}{t}{\vls(B_1.\cdots.B_n)}{\vls(A^y.\Gamma)}}{\Gamma}}\;\;\;\;.\;\;\;\;\Delta)}
\]
 \item $\tertuple{t_1}{t_n}$:
\[
  \vlsbr(\vlder{}{t_1}{A_1}{\Gamma_1}\;\;.\;\;\cdots\;\;.\;\;\vlder{}{t_n}{A_n}{\Gamma_n})
\]
\end{itemize}
\end{document}